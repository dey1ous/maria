<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Loan Management</title>
    <link rel="stylesheet" href="/css/admin-loan.css">
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>Admin Loan Applications</h1>
        </div>
        <!-- Loan List Table -->
        <section id="adminLoanSection">
            <h2>All Loan Applications</h2>
            <div id="adminLoanTableContainer">
                <table id="adminLoanTable">
                    <thead>
                        <tr>
                            <th>Loan ID</th>
                            <th>User ID</th>
                            <th>Amount</th>
                            <th>Status</th>
                            <th>Application Date</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Loan records will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>
        </section>
    </div>

    <script>
        // Fetch all loan applications for the admin
        async function fetchAllLoans() {
            try {
                const response = await fetch('/admin/loans');
                const loans = await response.json();
                
                if (loans.length > 0) {
                    // Populate the loan list table
                    const tableBody = document.getElementById("adminLoanTable").querySelector("tbody");
                    tableBody.innerHTML = ""; // Clear any existing rows

                    loans.forEach(loan => {
    const row = document.createElement("tr");
    row.innerHTML = ` 
        <td>${loan.id}</td>  <!-- Loan ID -->
        <td>${loan.userId}</td>  <!-- User ID -->
        <td>${loan.amount.toFixed(2)}</td>
        <td>${loan.status}</td>
        <td>${loan.applicationDate}</td>
        <td>
            <button onclick="approveLoan(${loan.id})">Approve</button>
            <button onclick="rejectLoan(${loan.id})">Reject</button>
        </td>
    `;
    tableBody.appendChild(row);
});
                } else {
                    const row = document.createElement("tr");
                    row.innerHTML = "<td colspan='6'>No loan applications found</td>";
                    document.getElementById("adminLoanTable").querySelector("tbody").appendChild(row);
                }
            } catch (error) {
                console.error("Error fetching loan applications:", error);
                alert("Failed to fetch loan applications.");
            }
        }

        async function approveLoan(loanId) {
            try {
                const response = await fetch(`/admin/loans/${loanId}/status?status=APPROVED`, {
                    method: 'PUT',
                });
                const updatedLoan = await response.json();
                alert(`Loan ${loanId} has been approved!`);
                fetchAllLoans(); // Refresh the loan list
            } catch (error) {
                console.error("Error approving loan:", error);
                alert("Failed to approve the loan.");
            }
        }

        // Reject loan
        async function rejectLoan(loanId) {
            try {
                const response = await fetch(`/admin/loans/${loanId}/status?status=REJECTED`, {
                    method: 'PUT',
                });
                const updatedLoan = await response.json();
                alert(`Loan ${loanId} has been rejected!`);
                fetchAllLoans(); // Refresh the loan list
            } catch (error) {
                console.error("Error rejecting loan:", error);
                alert("Failed to reject the loan.");
            }
        }

        // Load the loan list on page load
        window.onload = fetchAllLoans;

    </script>

</body>
</html>
